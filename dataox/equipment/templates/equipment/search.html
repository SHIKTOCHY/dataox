{% extends "elasticsearch/search.html" %}{% load humfrey_desc %}{% load humfrey_elasticsearch %}

{% block other_formats %}{% endblock %}

{% block body_class %}{{ block.super }} equipment-search{% endblock %}

{% block extra_head %}{% endblock %}

{% block content %}
  <h1>Search</h1>

  {% if not hits %}
    <h2 class="hidden">Query</h2>
    
    <form method="get" action="." class="advanced-search-form">
      <table>
        <tbody>
          {{ form }}
        </tbody>
        <tfoot>
          <tr>
            <td colspan="2">
              <input type="submit" value="Search"/>
            </td>
          </tr>
        </tfoot>
      </table>
    </form>
    
    <p>Example queries:</p>
    
    <ul>
      <li><tt>*</tt> (matches everything)</li>
      <li><tt>microscope</tt> (mostly things that are microscopes)</li>
      <li><tt>microscopy</tt> (things to do with microscopy)</li>
      <li><tt>micro*</tt> (things to do with small things)</li>
      <li><tt>category.label:cell</tt> (things in cell-related categories)</li>
    </ul>
  {% endif %}

      <div class="results">
  {% if hits %}

  <h2 class="hidden">Results</h2>

  <p class="numResults">
    Your search for <strong>{{ q }}</strong> returned <strong>{{ hits.total }}</strong> results.
{% if not user.is_authenticated %}
    <a href="{% url webauth:login %}?next={{ request.get_full_path|urlencode }}">Try logging in to see restricted results.</a>
{% endif %}
  </p>

 <div class="pagination" >
 {% include "elasticsearch/pagination.html" %}
  </div>
  <ol start="{{ start }}">
  {% for hit in hits.hits %}{% block hit %}
  <li>
    <h3><a href="{{ hit.source.uri|doc_url }}">{{ hit.source.label }}</a></h3>
    <dl class="equipment-search-meta">{% if hit.source.basedNear.label or hit.source.building.label %}
      <dt>Location:</dt>
      <dd>{{ hit.source.building.label|default:"" }}{% if hit.source.basedNear.label and hit.source.building.label %}, {% endif %}
          {{ hit.source.basedNear.label|default:"" }}</dd>{% endif %}{% if hit.source.availability.label %}
      <dt>Availability:</dt>
      <dd>{{ hit.source.availability.label }}</dd>{% endif %}
    </dl>
    <div style="clear: both"/>
    {% if hit.source.description %}
    <div class="equipment-search-description">{{ hit.source.description|search_html|truncatewords_html:25 }}</div>
    {% endif %}

  </li>
  {% endblock %}{% endfor %}
  </ol>

   <div class="pagination" >
 {% include "elasticsearch/pagination.html" %}
  </div>
  {% endif %}
  </div>
{% endblock %}

{% block with_right_sidebar %} with-right-sidebar{% endblock %}

{% block right_sidebar %}
  {% if hits %}
  <aside class="right-sidebar">
    <div class="sidebar-item search-box">
      <h2 class="hidden">Query</h2>
      <form method="get" action="." class="simpleSearch" >
        {{ form.q }}
        <input type="submit" value="Search"/>
      </form>
    </div>
  {% endif %}
  {% if facets and hits.total %}
    <div class="sidebar-item">
      <h2>refine by&hellip;</h2>
      {% if facets.institution %}
        {% include "elasticsearch/facet.html" with facet=facets.institution facet_name="institution" terse=1 %}
      {% endif %}
      {% if facets.department %}
        {% include "elasticsearch/facet.html" with facet=facets.department facet_name="department" terse=1 %}
      {% endif %}
      {% if facets.basedNear %}
        {% include "elasticsearch/facet.html" with facet=facets.basedNear facet_name="location" terse=1 %}
      {% endif %}
      {% if facets.category %}
        {% include "elasticsearch/facet.html" with facet=facets.category facet_name="category" terse=1 %}
      {% endif %}
      {% if facets.subcategory %}
        {% include "elasticsearch/facet.html" with facet=facets.subcategory facet_name="subcategory" terse=1 %}
      {% endif %}
      {% if facets.oxford %}
        {% include "elasticsearch/facet.html" with facet=facets.oxford facet_name="Oxford?" terse=1 %}
      {% endif %}
    </div>
  {% endif %}
  {% if hits %}
  </aside>
  {% endif %}
{% endblock %}
